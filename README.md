# TBBOX Playlist Switcher - 使い方

## 前提

- このアプリケーションは3つのGPIOピン（GPIO 18, 23, 24）に対応しています
- 各GPIOピンはTBBOXのプログラム（01, 02, 03）に対応しています

## 使い方

### 1. GPIOピンにスイッチを接続する

GPIOピンにスイッチを挿すだけでOKです。以下のピンが使用可能です：

- **GPIO 18** → プログラム「01」
- **GPIO 23** → プログラム「02」
- **GPIO 24** → プログラム「03」

### 2. Raspberry Piにログイン
SSH等でRaspberry Piにログインします。

### 3. 以下のコマンドでアプリケーションディレクトリに移動

```bash
cd /home/pi/tbbox-playlist-switcher
```

### 4. 仮想環境を有効化（切り替わるとユーザ名の先頭に(venv)という文字がつきます

```bash
source venv/bin/activate
```

**注意：仮想環境とは**
仮想環境は、このアプリケーション専用の箱のようなものです。
Raspberry Pi全体にこのアプリのためにインストールしたライブラリ（道具のようなもの）が影響しないようになっています。

### 5. アプリケーションを実行

```bash
python main.py
```

GPIOピンの監視が開始されます。

### 6. スイッチを押してプログラムを切り替え

スイッチを押下すると、対応するプログラムに切り替わります。

### 7. アプリケーションの停止

`Ctrl + C`でアプリケーションを停止できます。

## 注意事項

- 切り替え後に別のプログラムに切り替えようとすると切り替わらない時があります
- 再度切り替えたい場合は`Ctrl + C`でアプリを一度停止した後、アプリ起動(手順5)を再度実行すると確実です
- 仮想環境が有効でない場合、アプリは起動できません(手順4)

## 設定ファイルについて
このアプリケーションは以下の設定ファイルで動作を制御しています：

### 1. config/gpio_mapping.json

GPIOピン番号とTBBOXプログラムIDのマッピングを定義します。

```json
{
  "18": "01",
  "23": "02",
  "24": "03"
}
```

異なるGPIOピンを使用したい場合や、プログラムIDを変更したい場合はこのファイルを編集してください。

### 2. .env

TBBOX接続情報を管理します。実運用時はアプリに持たせない情報です：

- `TBBOX_IP`: TBBOXデバイスのIPアドレス
- `TBBOX_PORT`: TBBOXのポート番号（デフォルト：5503）
- `TBBOX_LOGIN_COMMAND`: 生成いただいたログインコマンド


### 3. config/settings.py
GPIOピンに対応するログインコマンドを設定しています。

- `PROGRAM_COMMANDS`に設定されています。
